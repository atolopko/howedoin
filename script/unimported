#!/usr/bin/env rails runner

options = Trollop.options do
  opt :account_id, "To Account", short: 'f', type: :string
  opt :memo, "Statement memo (regexp)", short: 'm', type: :string
end

query = PostedTransaction.where(txn_id: nil)
        
[:memo, :account_id].each do |attr|
  query = query.where("#{attr.to_s} ~* ?", options[attr]) if options[attr]
end

ap query.
    group(:account_id, :memo).
    order('memo').
    count

ap query.count


